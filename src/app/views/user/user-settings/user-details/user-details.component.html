<div class="user-details-container">
  <div class="user-details-form-container">

    <form #form="ngForm" class="ui form" (ngSubmit)="onSubmit()">
      <sm-loader [complete]="!loadingSubmit" class="inverted" text="{{'component.loading' | translate}}"></sm-loader>

      <div class="user-details-form-group-title">{{'user.settings.form.personal.info.header' | translate}}</div>

      <div class="field" [ngClass]="{'has-error':!settingsForm.controls['first_name'].valid || apiErrors.hasErrorsFor('first_name')}">
        <sm-input
          [control]="settingsForm.controls['first_name']"
          [label]="('user.settings.form.first.name.label' | translate) + ' *'"
          [placeholder]="'user.register.form.first.name.placeholder' | translate"
          class="left"
          icon="user"
          type="text">
        </sm-input>
        <div
          *ngIf="settingsForm.controls['first_name'].touched && settingsForm.controls['first_name'].hasError('required')"
          class="ui pointing red basic label">
          {{'user.settings.form.first.name.validation.required' | translate}}
        </div>
        <div
          *ngIf="settingsForm.controls['first_name'].hasError('minlength')"
          class="ui pointing red basic label">
          {{'user.settings.form.first.name.validation.min.length' | translate}}
        </div>
        <api-errors [errors]="apiErrors" attribute="first_name"></api-errors>
      </div>

      <div class="field" [ngClass]="{'has-error':!settingsForm.controls['last_name'].valid || apiErrors.hasErrorsFor('last_name')}">
        <sm-input
          [control]="settingsForm.controls['last_name']"
          [label]="('user.settings.form.last.name.label' | translate) + ' *'"
          [placeholder]="'user.settings.form.last.name.placeholder' | translate"
          class="left"
          icon="user"
          type="text">
        </sm-input>
        <div
          *ngIf="settingsForm.controls['last_name'].touched && settingsForm.controls['last_name'].hasError('required')"
          class="ui pointing red basic label">
          {{'user.settings.form.last.name.validation.required' | translate}}
        </div>
        <div
          *ngIf="settingsForm.controls['last_name'].hasError('minlength')"
          class="ui pointing red basic label">
          {{'user.settings.form.last.name.validation.min.length' | translate}}
        </div>
        <api-errors [errors]="apiErrors" attribute="last_name"></api-errors>
      </div>

      <div class="field" [ngClass]="{'has-error':!settingsForm.controls['email'].valid || apiErrors.hasErrorsFor('email')}">
        <sm-input
          [control]="settingsForm.controls['email']"
          [label]="('user.settings.form.email.label' | translate) + ' *'"
          [placeholder]="'user.settings.form.email.placeholder' | translate"
          class="left"
          icon="mail"
          type="email">
        </sm-input>
        <div
          *ngIf="settingsForm.controls['email'].touched && settingsForm.controls['email'].hasError('required')"
          class="ui pointing red basic label">
          {{'user.settings.form.email.validation.required' | translate}}
        </div>
        <div
          *ngIf="settingsForm.controls['email'].hasError('pattern')"
          class="ui pointing red basic label">
          {{'user.settings.form.email.validation.pattern' | translate}}
        </div>
        <api-errors [errors]="apiErrors" attribute="email"></api-errors>
      </div>

      <div class="field" [ngClass]="{'has-error':!settingsForm.controls['phone'].valid || apiErrors.hasErrorsFor('phone')}">
        <sm-input
          [control]="settingsForm.controls['phone']"
          [label]="('user.settings.form.phone.label' | translate) + ' *'"
          [placeholder]="'user.settings.form.phone.placeholder' | translate"
          class="left"
          icon="phone"
          type="text">
        </sm-input>
        <div
          *ngIf="settingsForm.controls['email'].touched && settingsForm.controls['phone'].hasError('required')"
          class="ui pointing red basic label">
          {{'user.settings.form.phone.validation.required' | translate}}
        </div>
        <api-errors [errors]="apiErrors" attribute="phone"></api-errors>
      </div>

      <hr>

      <div class="user-details-form-group-title">{{'user.settings.form.address.header' | translate}}</div>


      <div class="field" [ngClass]="{'error': (settingsForm.controls['street'].touched && !settingsForm.controls['street'].valid) || apiErrors.hasErrorsFor('street')}">
        <sm-input
          [control]="settingsForm.controls['street']"
          [label]="'user.register.form.street.header' | translate"
          [placeholder]="'user.register.form.street.placeholder' | translate"
          class="left"
          icon="map pin"
          type="text">
        </sm-input>
        <api-errors [errors]="apiErrors" attribute="street"></api-errors>
      </div>

      <div class="field" [ngClass]="{'error': (settingsForm.controls['zip'].touched && !settingsForm.controls['zip'].valid) || apiErrors.hasErrorsFor('zip')}">
        <sm-input
          [control]="settingsForm.controls['zip']"
          [label]="'user.register.form.zip.header' | translate"
          [placeholder]="'user.register.form.zip.placeholder' | translate"
          class="left"
          icon="map"
          type="text">
        </sm-input>
        <div
          *ngIf="settingsForm.controls['zip'].hasError('minlength')"
          class="ui pointing red basic label">
          {{'user.register.form.zip.validation.min.length' | translate}}
        </div>
        <api-errors [errors]="apiErrors" attribute="zip"></api-errors>
      </div>

      <div class="field" [ngClass]="{'error': (settingsForm.controls['city'].touched && !settingsForm.controls['city'].valid) || apiErrors.hasErrorsFor('city')}">
        <sm-input
          [control]="settingsForm.controls['city']"
          [label]="'user.register.form.city.header' | translate"
          [placeholder]="'user.register.form.city.placeholder' | translate"
          class="left"
          icon="building"
          type="text">
        </sm-input>
        <api-errors [errors]="apiErrors" attribute="city"></api-errors>
      </div>

      <hr>

      <div class="user-details-form-group-title">{{'user.settings.form.change.password.header' | translate}}</div>

      <div class="field" [ngClass]="{'has-error':!passwordForm.controls['password'].valid || !passwordForm.controls['repeat_password'].valid || apiErrors.hasErrorsFor('password')}">
        <sm-input
          [control]="passwordForm.controls['old_password']"
          [label]="'user.settings.form.new.password.label' | translate"
          [placeholder]="'user.settings.form.old.password.placeholder' | translate"
          class="left"
          icon="lock"
          type="password">
        </sm-input>
        <sm-input
          [control]="passwordForm.controls['password']"
          [label]="'user.settings.form.new.password.label' | translate"
          [placeholder]="'user.settings.form.new.password.placeholder' | translate"
          class="left"
          icon="lock"
          type="password">
        </sm-input>
        <sm-input
          [control]="passwordForm.controls['repeat_password']"
          [label]="'user.settings.form.new.password.label' | translate"
          [placeholder]="'user.settings.form.repeat.password.placeholder' | translate"
          class="left"
          icon="lock"
          type="password">
        </sm-input>
        <div *ngIf="passwordForm.controls['password'].hasError('minlength')" class="ui pointing red basic label">{{'user.settings.form.new.password.validation.min.length' | translate}}</div>
        <div *ngIf="passwordsSuppliedAndMisMatch()" class="ui pointing red basic label">{{'user.settings.form.repeat.password.validation.mismatch' | translate}}</div>
        <api-errors [errors]="apiErrors" attribute="password"></api-errors>
      </div>

      <hr class="user-details-form-ruler">

      <div class="user-details-form-group-title">{{'user.settings.form.bank.details.header' | translate}}</div>

      <div class="field" [ngClass]="{'error': (settingsForm.controls['account_clearing_number'].touched && !settingsForm.controls['account_clearing_number'].valid) || apiErrors.hasErrorsFor('account_clearing_number')}">
        <sm-input
          [control]="settingsForm.controls['account_clearing_number']"
          [label]="'user.settings.form.clearing.number.label' | translate"
          [placeholder]="'user.settings.form.clearing.number.placeholder' | translate"
          class="left"
          type="text">
        </sm-input>
        <api-errors [errors]="apiErrors" attribute="account_clearing_number"></api-errors>
      </div>

      <div class="field" [ngClass]="{'error': (settingsForm.controls['account_number'].touched && !settingsForm.controls['account_number'].valid) || apiErrors.hasErrorsFor('account_number')}">
        <sm-input
          [control]="settingsForm.controls['account_number']"
          [label]="'user.settings.form.account.number.label' | translate"
          [placeholder]="'user.settings.form.account.number.placeholder' | translate"
          class="left"
          type="text">
        </sm-input>
        <api-errors [errors]="apiErrors" attribute="account_number"></api-errors>
        <api-errors [errors]="apiErrors" attribute="account"></api-errors>
      </div>

      <div class="user-details-form-button-container">
        <div *ngIf="saveFail" class="user-details-form-error-message">{{'user.settings.form.submit.fail' | translate}}</div>
        <div *ngIf="saveSuccess" class="user-details-form-save-message">{{'user.settings.form.submit.success' | translate}}</div>
        <button class="user-details-form-button" *ngIf="!loadingSubmit" type="submit" class="btn-primary btn-small btn">{{'user.settings.form.submit.button' | translate}}</button>
      </div>
    </form>
  </div>
</div>
